<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Sarıkaya Kuyumculuk | Canlı Fiyat Paneli</title>
    <style>
        /* ... Önceki CSS kodları ... */
        body { margin: 0; font-family: 'Montserrat', sans-serif; background-color: #fcfaf7; overflow: hidden; height: 100vh; }
        
        /* Flaş Efektleri */
        .flash-up { background-color: rgba(0, 255, 0, 0.3) !important; transition: background-color 1s ease; }
        .flash-down { background-color: rgba(255, 0, 0, 0.3) !important; transition: background-color 1s ease; }
        
        /* Diğer Tasarım */
        .price-val { transition: all 0.5s; padding: 5px; border-radius: 4px; }
        /* ... (Kalan tasarım kodları öncekiyle aynı) ... */
    </style>
</head>
<body>

<div id="goldRows"></div>

<script>
// --- KALİBRASYON AYARI ---
// Eğer fiyatlar senin ekranından düşükse bu sayıyı 1.0335 -> 1.0345 yap
// Eğer yüksekse 1.0335 -> 1.0325 yap
const FIYAT_DUZELTME_CARPANI = 1.0335; 

async function piyasaGuncelle() {
    try {
        const dRes = await fetch("https://open.er-api.com/v6/latest/USD");
        const dData = await dRes.json();
        const usdTry = dData.rates.TRY;
        const aRes = await fetch("https://api.gold-api.com/price/XAU");
        const aData = await aRes.json();
        const ons = aData.price;

        let hasAlis = (ons / 31.1035) * usdTry * FIYAT_DUZELTME_CARPANI;
        let hasSatis = hasAlis + 53;

        // Fiyat Listesi
        const data = [
            {id: "has", n:"HAS ALTIN (24K)", a:hasAlis, s:hasSatis},
            {id: "pak", n:"PAKETLİ HAS", a:hasAlis, s:hasSatis + 47}, 
            {id: "22a", n:"22 AYAR ALTIN", a:hasAlis * 0.912, s:hasSatis * 0.933}, 
            {id: "cey", n:"ÇEYREK ALTIN", a:hasAlis * 1.628, s:hasAlis * 1.655},
            {id: "yar", n:"YARIM ALTIN", a:hasAlis * 3.251, s:hasAlis * 3.310},
            {id: "tam", n:"TAM ALTIN", a:hasAlis * 6.473, s:hasAlis * 6.568},
            {id: "ata", n:"ATA LİRA", a:hasAlis * 6.689, s:(hasAlis * 6.783) + 300}
        ];

        data.forEach(item => {
            updateRow(item);
        });
    } catch (e) { console.error(e); }
}

function updateRow(item) {
    let rowId = "row-" + item.id;
    let existingRow = document.getElementById(rowId);
    
    // Fiyatları yuvarla
    let newBuy = Math.floor(item.a);
    let newSell = Math.ceil(item.s);

    if (!existingRow) {
        // İlk yükleme
        let html = `<div id="${rowId}" class="price-row">
            <span class="prod-name">${item.n}</span>
            <span class="price-val buy" id="${rowId}-a">${newBuy.toLocaleString('tr-TR')}</span>
            <span class="price-val sell" id="${rowId}-s">${newSell.toLocaleString('tr-TR')}</span>
        </div>`;
        document.getElementById("goldRows").insertAdjacentHTML('beforeend', html);
    } else {
        // Güncelleme ve Flaş Efekti
        updateCell(rowId + "-a", newBuy);
        updateCell(rowId + "-s", newSell);
    }
}

function updateCell(cellId, newVal) {
    let el = document.getElementById(cellId);
    let oldVal = parseInt(el.innerText.replace(/\./g, ''));
    
    if (newVal !== oldVal) {
        el.innerText = newVal.toLocaleString('tr-TR');
        // Efekt sınıfını ekle
        el.className = (newVal > oldVal) ? "price-val flash-up" : "price-val flash-down";
        // 1 saniye sonra efekti kaldır
        setTimeout(() => {
            el.className = "price-val";
        }, 1000);
    }
}

piyasaGuncelle();
setInterval(piyasaGuncelle, 15000); // 15 saniyeye indirdim
</script>
</body>
</html>
